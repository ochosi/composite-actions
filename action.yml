name: "Create and push tag"
description: "Create a tag and push it"

inputs:
  token:
    description: "A GitHub token for creating a tag"
    required: true
  username:
    description: "A GitHub user name"
    required: true
  email:
    description: "The GitHub user's email address"
    required: true

runs:
  using: "composite"
  steps:
    - name: Checkout current repo
      uses: actions/checkout@v3
      with:
          token: "${{ inputs.TOKEN }}"
          fetch-depth: 0

    - name: Set up git
      run:  |
        git config --global user.email "${{ inputs.EMAIL }}"
        git config --global user.name "${{ inputs.USERNAME }}"
    # GitHub's checkout action doesn't properly fetch the current tag
    #    git fetch --tags --prune --force
      shell: bash

    - uses: actions/setup-python@v2
      with:
        python-version: '3.9'
    - name: Create tag
      run: ${{ github.action_path }}/release.py --user "${{ inputs.USERNAME }}" --token "${{ inputs.TOKEN }}" --no-interactive